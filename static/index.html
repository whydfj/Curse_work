<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SkillTracker Pro</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4F46E5;
            --primary-dark: #4338CA;
            --primary-light: #6366F1;
            --secondary: #10B981;
            --accent: #EF476F;
            --background: #FFFFFF;
            --surface: #F8FAFC;
            --surface-elevated: #FFFFFF;
            --surface-high: #F1F5F9;
            --text-primary: #1E293B;
            --text-secondary: #64748B;
            --text-tertiary: #94A3B8;
            --border: #E2E8F0;
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            --shadow-hover: 0 8px 30px rgba(0, 0, 0, 0.12);
            --glass: rgba(255, 255, 255, 0.7);
            --blur: blur(20px);
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 20px;
            --transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--background);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
            min-height: 100vh;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideInLeft {
            from { opacity: 0; transform: translateX(-30px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(30px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .auth-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            animation: fadeIn 1s ease-out;
            background: linear-gradient(135deg, #F0F4FF 0%, #F8FAFC 100%);
        }

        .auth-card {
            background: var(--surface-elevated);
            border: 1px solid var(--border);
            border-radius: var(--radius-xl);
            padding: 48px 40px;
            width: 100%;
            max-width: 480px;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .auth-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }

        .auth-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .auth-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 16px;
            font-size: 28px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .auth-logo i {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 32px;
        }

        .auth-subtitle {
            color: var(--text-secondary);
            font-size: 16px;
            font-weight: 400;
        }

        .input-group {
            margin-bottom: 24px;
            position: relative;
        }

        .input-label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-secondary);
            font-weight: 500;
            font-size: 14px;
        }

        .input-field {
            width: 100%;
            padding: 16px 20px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            font-size: 16px;
            transition: var(--transition);
            font-family: 'Inter', sans-serif;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .input-field::placeholder {
            color: var(--text-tertiary);
        }

        .select-field {
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%2364748B' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 16px center;
            background-size: 16px;
        }

        .auth-button {
            width: 100%;
            padding: 16px 24px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            border-radius: var(--radius-md);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .auth-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.7s;
        }

        .auth-button:hover::before {
            left: 100%;
        }

        .auth-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 24px rgba(79, 70, 229, 0.3);
        }

        .app-container {
            display: none;
            min-height: 100vh;
        }

        .top-navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: var(--surface-elevated);
            border-bottom: 1px solid var(--border);
            padding: 0 24px;
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            z-index: 1000;
            box-shadow: var(--shadow);
        }

        .nav-brand {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .nav-brand i {
            font-size: 28px;
        }

        .nav-menu {
            display: flex;
            align-items: center;
            gap: 8px;
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .nav-item {
            position: relative;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            border-radius: var(--radius-md);
            color: var(--text-secondary);
            text-decoration: none;
            transition: var(--transition);
            font-weight: 500;
            font-size: 15px;
        }

        .nav-link:hover, .nav-link.active {
            background: var(--surface-high);
            color: var(--text-primary);
        }

        .nav-link i {
            font-size: 18px;
            width: 20px;
        }

        .nav-actions {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .search-container {
            position: relative;
            width: 300px;
        }

        .search-input {
            width: 100%;
            padding: 12px 44px 12px 16px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            color: var(--text-primary);
            font-size: 14px;
            transition: var(--transition);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .search-icon {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-tertiary);
        }

        .user-menu-container {
            position: relative;
        }

        .user-button {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 16px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            cursor: pointer;
            transition: var(--transition);
        }

        .user-button:hover {
            background: var(--surface-high);
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: var(--radius-md);
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 16px;
            color: white;
        }

        .user-info {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .user-name {
            font-size: 14px;
            font-weight: 600;
        }

        .user-role {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .user-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 8px;
            background: var(--surface-elevated);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 8px;
            width: 200px;
            box-shadow: var(--shadow-hover);
            display: none;
            z-index: 1001;
        }

        .user-dropdown.active {
            display: block;
            animation: fadeIn 0.3s ease-out;
        }

        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            border-radius: var(--radius-md);
            color: var(--text-secondary);
            text-decoration: none;
            transition: var(--transition);
            cursor: pointer;
        }

        .dropdown-item:hover {
            background: var(--surface-high);
            color: var(--text-primary);
        }

        .dropdown-item i {
            width: 20px;
            text-align: center;
        }

        .main-content {
            margin-top: 70px;
            padding: 32px;
            min-height: calc(100vh - 70px);
            animation: fadeIn 0.8s ease-out;
        }

        .content-section {
            display: none;
            animation: fadeIn 0.6s ease-out;
        }

        .content-section.active {
            display: block;
        }

        .section-header {
            margin-bottom: 32px;
        }

        .section-title {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .section-subtitle {
            font-size: 18px;
            color: var(--text-secondary);
            font-weight: 400;
        }

        .action-buttons {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: var(--surface-elevated);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 24px;
            transition: var(--transition);
            box-shadow: var(--shadow);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
        }

        .stat-card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .stat-card-icon {
            width: 48px;
            height: 48px;
            border-radius: var(--radius-md);
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
        }

        .stat-card-value {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .stat-card-label {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .tasks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 24px;
        }

        .task-card {
            background: var(--surface-elevated);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 24px;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .task-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(to bottom, var(--primary), var(--secondary));
        }

        .task-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .task-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .task-priority {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .priority-high {
            background: rgba(239, 71, 111, 0.1);
            color: var(--accent);
        }

        .priority-medium {
            background: rgba(255, 193, 7, 0.1);
            color: #D97706;
        }

        .priority-low {
            background: rgba(6, 214, 160, 0.1);
            color: var(--secondary);
        }

        .task-description {
            color: var(--text-secondary);
            margin-bottom: 20px;
            font-size: 14px;
        }

        .task-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .task-assignee {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .assignee-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
            color: white;
        }

        .assignee-name {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .task-actions {
            display: flex;
            gap: 8px;
        }

        .task-action {
            width: 36px;
            height: 36px;
            border-radius: var(--radius-md);
            background: var(--surface);
            border: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition);
        }

        .task-action:hover {
            background: var(--surface-high);
            color: var(--text-primary);
        }

        .task-comments {
            width: 100%;
            margin-top: 15px;
            border-top: 1px solid var(--border);
            padding-top: 15px;
        }

        .comment {
            background: var(--surface);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .comment-author {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 5px;
            font-size: 14px;
        }

        .comment-text {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .comment-form {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .comment-input {
            flex: 1;
            padding: 12px;
            border: 1px solid var(--border);
            border-radius: 8px;
            background-color: var(--surface);
            color: var(--text-primary);
        }

        .comment-btn {
            padding: 12px 20px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }

        .assistant-container {
            display: flex;
            flex-direction: column;
            height: 600px;
            background: var(--surface-elevated);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .assistant-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            background: var(--surface);
        }

        .assistant-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .assistant-title i {
            color: var(--primary);
        }

        .assistant-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .message {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 18px;
            font-size: 14px;
            line-height: 1.5;
        }

        .message-user {
            align-self: flex-end;
            background: var(--primary);
            color: white;
            border-bottom-right-radius: 4px;
        }

        .message-assistant {
            align-self: flex-start;
            background: var(--surface-high);
            color: var(--text-primary);
            border-bottom-left-radius: 4px;
        }

        .assistant-input-container {
            padding: 20px;
            border-top: 1px solid var(--border);
            background: var(--surface);
        }

        .assistant-input-wrapper {
            display: flex;
            gap: 10px;
        }

        .assistant-input {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid var(--border);
            border-radius: 24px;
            background: var(--surface-elevated);
            color: var(--text-primary);
            font-family: 'Inter', sans-serif;
            resize: none;
            height: 44px;
            max-height: 120px;
        }

        .assistant-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .assistant-send {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .assistant-send:hover {
            background: var(--primary-dark);
            transform: scale(1.05);
        }

        .assistant-send:disabled {
            background: var(--text-tertiary);
            cursor: not-allowed;
            transform: none;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(30, 41, 59, 0.5);
            backdrop-filter: blur(4px);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            animation: fadeIn 0.3s ease-out;
        }

        .modal-content {
            background: var(--surface-elevated);
            border: 1px solid var(--border);
            border-radius: var(--radius-xl);
            padding: 40px;
            width: 100%;
            max-width: 520px;
            box-shadow: var(--shadow-hover);
            animation: slideInRight 0.4s ease-out;
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 24px;
            right: 24px;
            width: 40px;
            height: 40px;
            border-radius: var(--radius-md);
            background: var(--surface);
            border: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition);
        }

        .modal-close:hover {
            background: var(--surface-high);
            color: var(--text-primary);
        }

        .modal-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .modal-subtitle {
            color: var(--text-secondary);
            margin-bottom: 32px;
        }

        .form-actions {
            display: flex;
            gap: 16px;
            margin-top: 32px;
        }

        .btn {
            padding: 16px 32px;
            border-radius: var(--radius-md);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            font-family: 'Inter', sans-serif;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 24px rgba(79, 70, 229, 0.3);
        }

        .btn-secondary {
            background: var(--surface);
            border: 1px solid var(--border);
            color: var(--text-primary);
        }

        .btn-secondary:hover {
            background: var(--surface-high);
        }

        .profile-section {
            background: var(--surface-elevated);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 32px;
            margin-bottom: 24px;
            box-shadow: var(--shadow);
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 32px;
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: var(--radius-lg);
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            font-weight: 700;
            color: white;
        }

        .profile-info h2 {
            font-size: 24px;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .profile-info p {
            color: var(--text-secondary);
        }

        .profile-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .detail-item {
            margin-bottom: 16px;
        }

        .detail-label {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        .detail-value {
            font-size: 16px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        .error-message {
            background: #FEF2F2;
            border: 1px solid #FECACA;
            color: #DC2626;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 16px;
        }

        .success-message {
            background: #F0FDF4;
            border: 1px solid #BBF7D0;
            color: #16A34A;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 16px;
        }

        @media (max-width: 1024px) {
            .nav-menu {
                gap: 4px;
            }

            .nav-link {
                padding: 10px 16px;
                font-size: 14px;
            }

            .search-container {
                width: 250px;
            }
        }

        @media (max-width: 768px) {
            .top-navbar {
                padding: 0 16px;
            }

            .nav-menu {
                display: none;
            }

            .search-container {
                width: 200px;
            }

            .main-content {
                padding: 20px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .tasks-grid {
                grid-template-columns: 1fr;
            }

            .message {
                max-width: 90%;
            }
        }

        @media (max-width: 480px) {
            .auth-card {
                padding: 32px 24px;
            }

            .search-container {
                display: none;
            }

            .user-info {
                display: none;
            }

            .section-title {
                font-size: 24px;
            }

            .form-actions {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="auth-container" id="authContainer">
        <div class="auth-card">
            <div class="auth-header">
                <div class="auth-logo">
                    <i class="fas fa-chart-network"></i>
                    SkillTracker Pro
                </div>
                <p class="auth-subtitle">Войдите в систему для управления задачами и производительностью</p>
            </div>
            <div id="authMessages"></div>
            <div class="input-group">
                <label class="input-label">Логин или Email</label>
                <input type="text" class="input-field" id="username" placeholder="Ваш логин или email">
            </div>
            <div class="input-group">
                <label class="input-label">Пароль</label>
                <input type="password" class="input-field" id="password" placeholder="Ваш пароль">
            </div>
            <button class="auth-button" id="loginButton">
                <span>Войти в систему</span>
            </button>
        </div>
    </div>

    <div class="app-container" id="appContainer">
        <nav class="top-navbar">
            <div class="nav-brand">
                <i class="fas fa-chart-network"></i>
                SkillTracker
            </div>

            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="#" class="nav-link active" data-section="tasks">
                        <i class="fas fa-tasks"></i>
                        <span>Задания</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="employees">
                        <i class="fas fa-users"></i>
                        <span>Сотрудники</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="assistant">
                        <i class="fas fa-robot"></i>
                        <span>AI Помощник</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="profile">
                        <i class="fas fa-user"></i>
                        <span>Профиль</span>
                    </a>
                </li>
            </ul>

            <div class="nav-actions">
                <div class="search-container">
                    <input type="text" class="search-input" placeholder="Поиск задач, сотрудников...">
                    <i class="fas fa-search search-icon"></i>
                </div>

                <div class="user-menu-container">
                    <div class="user-button" id="userMenuButton">
                        <div class="user-avatar" id="navUserAvatar">U</div>
                        <div class="user-info">
                            <div class="user-name" id="navUserName">Пользователь</div>
                            <div class="user-role" id="navUserRole">user</div>
                        </div>
                        <i class="fas fa-chevron-down"></i>
                    </div>

                    <div class="user-dropdown" id="userDropdown">
                        <div class="dropdown-item" data-section="profile">
                            <i class="fas fa-user"></i>
                            <span>Мой профиль</span>
                        </div>
                        <div class="dropdown-item" id="logoutButton">
                            <i class="fas fa-sign-out-alt"></i>
                            <span>Выйти</span>
                        </div>
                    </div>
                </div>
            </div>
        </nav>

        <div class="main-content" id="mainContent">
            <div class="content-area">
                <div class="content-section active" id="tasks">
                    <div class="section-header">
                        <h1 class="section-title">Задания</h1>
                        <p class="section-subtitle">Управление задачами и отслеживание прогресса</p>
                    </div>

                    <div id="taskMessages"></div>
                    <div class="action-buttons" id="taskActionButtons">
                    </div>

                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-card-header">
                                <div class="stat-card-icon">
                                    <i class="fas fa-tasks"></i>
                                </div>
                            </div>
                            <div class="stat-card-value" id="totalTasks">0</div>
                            <div class="stat-card-label">Всего задач</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card-header">
                                <div class="stat-card-icon">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                            </div>
                            <div class="stat-card-value" id="completedTasks">0</div>
                            <div class="stat-card-label">Выполнено</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card-header">
                                <div class="stat-card-icon">
                                    <i class="fas fa-clock"></i>
                                </div>
                            </div>
                            <div class="stat-card-value" id="pendingTasks">0</div>
                            <div class="stat-card-label">В ожидании</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card-header">
                                <div class="stat-card-icon">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                            </div>
                            <div class="stat-card-value" id="performance">0%</div>
                            <div class="stat-card-label">Продуктивность</div>
                        </div>
                    </div>

                    <div class="tasks-grid" id="tasksList">
                    </div>
                </div>

                <div class="content-section" id="employees">
                    <div class="section-header">
                        <h1 class="section-title">Сотрудники</h1>
                        <p class="section-subtitle">Управление командой и назначение задач</p>
                    </div>

                    <div id="employeeMessages"></div>
                    <div class="action-buttons" id="employeeActionButtons">
                    </div>

                    <div class="tasks-grid" id="employeesList">
                    </div>
                </div>

                <div class="content-section" id="assistant">
                    <div class="section-header">
                        <h1 class="section-title">AI Помощник</h1>
                        <p class="section-subtitle">Задавайте вопросы и получайте помощь по работе с системой</p>
                    </div>

                    <div class="assistant-container">
                        <div class="assistant-header">
                            <div class="assistant-title">
                                <i class="fas fa-robot"></i>
                                <span>SkillTracker Assistant</span>
                            </div>
                        </div>
                        <div class="assistant-messages" id="assistantMessages">
                            <div class="message message-assistant">
                                Привет! Я ваш AI помощник. Чем могу помочь вам сегодня?
                            </div>
                        </div>
                        <div class="assistant-input-container">
                            <div class="assistant-input-wrapper">
                                <textarea class="assistant-input" id="assistantInput" placeholder="Введите ваш вопрос..." rows="1"></textarea>
                                <button class="assistant-send" id="assistantSend">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="content-section" id="profile">
                    <div class="section-header">
                        <h1 class="section-title">Мой профиль</h1>
                        <p class="section-subtitle">Управление вашей учетной записью</p>
                    </div>

                    <div class="profile-section">
                        <div class="profile-header">
                            <div class="profile-avatar" id="profileAvatar">U</div>
                            <div class="profile-info">
                                <h2 id="profileName">Пользователь</h2>
                                <p id="profileRole">user</p>
                            </div>
                        </div>

                        <div class="profile-details">
                            <div class="detail-item">
                                <div class="detail-label">Email</div>
                                <div class="detail-value" id="profileEmail">user@example.com</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Дата регистрации</div>
                                <div class="detail-value" id="profileCreatedAt">-</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Имя</div>
                                <div class="detail-value" id="profileFirstName">-</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Фамилия</div>
                                <div class="detail-value" id="profileLastName">-</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="createTaskModal">
        <div class="modal-content">
            <div class="modal-close" id="closeTaskModal">
                <i class="fas fa-times"></i>
            </div>
            <h2 class="modal-title">Новая задача</h2>
            <p class="modal-subtitle">Создайте новую задачу для сотрудника</p>

            <div id="createTaskMessages"></div>

            <div class="input-group">
                <label class="input-label">Сотрудник</label>
                <select class="input-field select-field" id="taskUsername">
                    <option value="">Выберите сотрудника</option>
                </select>
            </div>

            <div class="input-group">
                <label class="input-label">Название задачи</label>
                <input type="text" class="input-field" id="taskTitle" placeholder="Введите название задачи">
            </div>

            <div class="input-group">
                <label class="input-label">Описание</label>
                <textarea class="input-field" id="taskDescription" placeholder="Опишите задачу" rows="4"></textarea>
            </div>

            <div class="input-group">
                <label class="input-label">Приоритет</label>
                <select class="input-field select-field" id="taskPriority">
                    <option value="low">Низкий</option>
                    <option value="medium">Средний</option>
                    <option value="high">Высокий</option>
                </select>
            </div>

            <div class="input-group">
                <label class="input-label">Дедлайн</label>
                <input type="datetime-local" class="input-field" id="taskDeadline">
            </div>

            <div class="form-actions">
                <button class="btn btn-primary" id="createTaskBtn">Создать задачу</button>
                <button class="btn btn-secondary" id="cancelTaskBtn">Отмена</button>
            </div>
        </div>
    </div>

    <div class="modal" id="createUserModal">
        <div class="modal-content">
            <div class="modal-close" id="closeUserModal">
                <i class="fas fa-times"></i>
            </div>
            <h2 class="modal-title">Новый пользователь</h2>
            <p class="modal-subtitle">Создайте нового пользователя системы</p>

            <div id="createUserMessages"></div>

            <div class="input-group">
                <label class="input-label">Логин</label>
                <input type="text" class="input-field" id="userUsername" placeholder="Введите логин">
            </div>

            <div class="input-group">
                <label class="input-label">Пароль</label>
                <input type="password" class="input-field" id="userPassword" placeholder="Введите пароль">
            </div>

            <div class="input-group">
                <label class="input-label">Роль</label>
                <select class="input-field select-field" id="userRole">
                    <option value="employee">Сотрудник</option>
                    <option value="manager">Менеджер</option>
                    <option value="admin">Администратор</option>
                </select>
            </div>

            <div class="input-group">
                <label class="input-label">Имя</label>
                <input type="text" class="input-field" id="userName" placeholder="Введите имя">
            </div>

            <div class="input-group">
                <label class="input-label">Фамилия</label>
                <input type="text" class="input-field" id="userSurname" placeholder="Введите фамилию">
            </div>

            <div class="input-group">
                <label class="input-label">Email</label>
                <input type="email" class="input-field" id="userEmail" placeholder="Введите email">
            </div>

            <div class="form-actions">
                <button class="btn btn-primary" id="createUserBtn">Создать пользователя</button>
                <button class="btn btn-secondary" id="cancelUserBtn">Отмена</button>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000';
let currentUser = null;
let allUsers = [];
let allTasks = [];

// API функции
const api = {
    async request(endpoint, options = {}) {
        const url = `${API_BASE}/api${endpoint}`;
        const config = {
            credentials: 'include',
            headers: {
                'Content-Type': 'application/json',
                ...options.headers
            },
            ...options
        };

        if (options.body) {
            config.body = JSON.stringify(options.body);
        }

        try {
            const response = await fetch(url, config);

            // Проверяем, если ответ не JSON
            const contentType = response.headers.get('content-type');
            if (contentType && contentType.includes('application/json')) {
                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.detail || `HTTP error! status: ${response.status}`);
                }

                return data;
            } else {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return null;
            }
        } catch (error) {
            console.error('API request failed:', error);
            throw error;
        }
    },

    async login(username, password) {
        const response = await fetch(`${API_BASE}/api/login`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            credentials: 'include',
            body: JSON.stringify({ username, password })
        });

        if (!response.ok) {
            const error = await response.json();
            throw new Error(error.detail || 'Ошибка авторизации');
        }

        return await response.json();
    },

    async logout() {
        return this.request('/logout', { method: 'POST' });
    },

    async getCurrentUser() {
        try {
            return await this.request('/get_current_user');
        } catch (error) {
            throw new Error('Не удалось получить данные пользователя');
        }
    },

    async getMyTasks() {
        try {
            const response = await fetch(`${API_BASE}/api/get_my_tasks`, {
                method: 'GET',
                credentials: 'include'
            });

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            return await response.json();
        } catch (error) {
            console.error('Error fetching tasks:', error);
            return [];
        }
    },

    async getAllTasks() {
        try {
            return await this.request('/get_all_tasks');
        } catch (error) {
            console.error('Error fetching all tasks:', error);
            return [];
        }
    },

    async getAllUsers() {
        try {
            return await this.request('/found/show_all');
        } catch (error) {
            console.error('Error fetching users:', error);
            return [];
        }
    },

    async createTask(taskData) {
        return this.request('/add_task', {
            method: 'POST',
            body: taskData
        });
    },

    async createUser(userData) {
        return this.request('/create_user', {
            method: 'POST',
            body: userData
        });
    },

    async updateTaskProgress(taskTitle, progress) {
        return this.request('/tasks/progress', {
            method: 'PATCH',
            body: { task_title: taskTitle, progress }
        });
    },

    async aiRequest(question) {
        return this.request('/ai_request', {
            method: 'POST',
            body: { question }
        });
    }
};

// Утилиты
const utils = {
    showMessage(elementId, message, type = 'error') {
        const container = document.getElementById(elementId);
        const messageDiv = document.createElement('div');
        messageDiv.className = type === 'error' ? 'error-message' : 'success-message';
        messageDiv.textContent = message;
        container.innerHTML = '';
        container.appendChild(messageDiv);

        if (type === 'success') {
            setTimeout(() => {
                messageDiv.remove();
            }, 5000);
        }
    },

    clearMessages(elementId) {
        const container = document.getElementById(elementId);
        container.innerHTML = '';
    },

    formatDate(dateString) {
        if (!dateString) return '-';
        try {
            return new Date(dateString).toLocaleDateString('ru-RU', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        } catch (e) {
            return dateString;
        }
    },

    showLoading(element) {
        element.classList.add('loading');
    },

    hideLoading(element) {
        element.classList.remove('loading');
    }
};

// Функции управления интерфейсом
const ui = {
    async init() {
        this.setupEventListeners();
        await this.checkAuth();
    },

    setupEventListeners() {
        // Авторизация
        document.getElementById('loginButton').addEventListener('click', () => this.handleLogin());
        document.getElementById('logoutButton').addEventListener('click', () => this.handleLogout());
        document.getElementById('password').addEventListener('keydown', (e) => {
            if (e.key === 'Enter') this.handleLogin();
        });

        // Навигация
        document.querySelectorAll('.nav-link, .dropdown-item').forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                const section = item.getAttribute('data-section');
                if (section) this.showSection(section);
            });
        });

        // Меню пользователя
        document.getElementById('userMenuButton').addEventListener('click', () => {
            document.getElementById('userDropdown').classList.toggle('active');
        });

        // Модальные окна
        document.getElementById('closeTaskModal').addEventListener('click', () => this.hideModal('createTaskModal'));
        document.getElementById('cancelTaskBtn').addEventListener('click', () => this.hideModal('createTaskModal'));
        document.getElementById('closeUserModal').addEventListener('click', () => this.hideModal('createUserModal'));
        document.getElementById('cancelUserBtn').addEventListener('click', () => this.hideModal('createUserModal'));

        // Создание задач
        document.getElementById('createTaskBtn').addEventListener('click', () => this.handleCreateTask());
        document.getElementById('createUserBtn').addEventListener('click', () => this.handleCreateUser());

        // AI помощник
        document.getElementById('assistantSend').addEventListener('click', () => this.handleAIMessage());
        document.getElementById('assistantInput').addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                this.handleAIMessage();
            }
        });

        // Автоподстройка высоты textarea
        document.getElementById('assistantInput').addEventListener('input', function() {
            this.style.height = '44px';
            this.style.height = (this.scrollHeight) + 'px';
        });

        // Закрытие модальных окон
        window.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal')) {
                this.hideModal(e.target.id);
            }
            if (!e.target.closest('.user-menu-container')) {
                document.getElementById('userDropdown').classList.remove('active');
            }
        });
    },

    async checkAuth() {
        try {
            const user = await api.getCurrentUser();
            this.handleAuthSuccess(user);
        } catch (error) {
            this.showAuthScreen();
        }
    },

    async handleLogin() {
        const username = document.getElementById('username').value.trim();
        const password = document.getElementById('password').value.trim();

        if (!username || !password) {
            utils.showMessage('authMessages', 'Пожалуйста, заполните все поля');
            return;
        }

        const loginBtn = document.getElementById('loginButton');
        utils.showLoading(loginBtn);

        try {
            const result = await api.login(username, password);
            this.handleAuthSuccess(result.user || result);
        } catch (error) {
            utils.showMessage('authMessages', error.message || 'Ошибка авторизации');
        } finally {
            utils.hideLoading(loginBtn);
        }
    },

    async handleLogout() {
        try {
            await api.logout();
            this.showAuthScreen();
        } catch (error) {
            console.error('Logout error:', error);
            this.showAuthScreen();
        }
    },

    handleAuthSuccess(userData) {
        currentUser = userData;
        this.showAppScreen();
        this.updateUserInfo(userData);
        this.loadInitialData();
    },

    showAuthScreen() {
        document.getElementById('authContainer').style.display = 'flex';
        document.getElementById('appContainer').style.display = 'none';
        currentUser = null;
        document.getElementById('username').value = '';
        document.getElementById('password').value = '';
    },

    showAppScreen() {
        document.getElementById('authContainer').style.display = 'none';
        document.getElementById('appContainer').style.display = 'block';
        utils.clearMessages('authMessages');
    },

    updateUserInfo(user) {
        const firstLetter = user.username ? user.username.charAt(0).toUpperCase() : 'U';

        document.getElementById('navUserName').textContent = user.username || 'Пользователь';
        document.getElementById('navUserRole').textContent = user.role || 'user';
        document.getElementById('navUserAvatar').textContent = firstLetter;

        document.getElementById('profileName').textContent = user.username || 'Пользователь';
        document.getElementById('profileRole').textContent = user.role || 'user';
        document.getElementById('profileAvatar').textContent = firstLetter;
        document.getElementById('profileEmail').textContent = user.email_user || '-';
        document.getElementById('profileCreatedAt').textContent = utils.formatDate(user.created_at);
        document.getElementById('profileFirstName').textContent = user.name || '-';
        document.getElementById('profileLastName').textContent = user.surname || '-';
    },

    async loadInitialData() {
        await this.loadTasks();
        await this.loadUsers();
        this.updateActionButtons();
    },

    async loadTasks() {
        try {
            let tasks;
            if (currentUser.role === 'employee') {
                tasks = await api.getMyTasks();
            } else {
                tasks = await api.getAllTasks();
            }
            allTasks = tasks || [];
            this.renderTasks();
            this.updateStats();
        } catch (error) {
            console.error('Error loading tasks:', error);
            utils.showMessage('taskMessages', 'Ошибка загрузки задач');
        }
    },

    async loadUsers() {
        try {
            if (currentUser.role === 'admin' || currentUser.role === 'manager') {
                allUsers = await api.getAllUsers() || [];
                this.renderUsers();
                this.updateUserSelects();
            }
        } catch (error) {
            console.error('Error loading users:', error);
        }
    },

    renderTasks() {
        const container = document.getElementById('tasksList');
        if (!allTasks || allTasks.length === 0) {
            container.innerHTML = `
                <div class="task-card" style="grid-column: 1 / -1; text-align: center; padding: 48px;">
                    <i class="fas fa-tasks" style="font-size: 48px; margin-bottom: 16px; opacity: 0.5;"></i>
                    <h3 style="margin-bottom: 8px;">Нет задач</h3>
                    <p style="color: var(--text-secondary);">Задачи не найдены</p>
                </div>
            `;
            return;
        }

        container.innerHTML = allTasks.map(task => `
            <div class="task-card">
                <div class="task-header">
                    <div>
                        <h3 class="task-title">${task.title || 'Без названия'}</h3>
                        <span class="task-priority priority-${task.priority || 'medium'}">
                            ${this.getPriorityText(task.priority || 'medium')}
                        </span>
                    </div>
                    <div class="task-actions">
                        ${currentUser.role !== 'employee' ? `
                        <div class="task-action edit-task" data-task-id="${task.id}">
                            <i class="fas fa-edit"></i>
                        </div>
                        <div class="task-action delete-task" data-task-id="${task.id}">
                            <i class="fas fa-trash"></i>
                        </div>
                        ` : ''}
                    </div>
                </div>
                <p class="task-description">${task.description || 'Описание отсутствует'}</p>
                <div class="task-footer">
                    <div class="task-assignee">
                        <div class="assignee-avatar">
                            ${task.employee && task.employee.username ? task.employee.username.charAt(0).toUpperCase() : 'U'}
                        </div>
                        <span class="assignee-name">
                            ${task.employee ? (task.employee.name && task.employee.surname ?
                                `${task.employee.name} ${task.employee.surname}` :
                                task.employee.username) : 'Неизвестно'}
                        </span>
                    </div>
                    <div class="task-progress">
                        <span style="font-size: 14px; color: var(--text-secondary);">${task.progress || 0}%</span>
                    </div>
                </div>
                ${currentUser.role === 'employee' ? `
                <div class="task-comments">
                    <div class="comment-form">
                        <input type="number" class="comment-input"
                               placeholder="Прогресс (0-100)" min="0" max="100"
                               value="${task.progress || 0}"
                               data-task-title="${task.title}">
                        <button class="comment-btn update-progress" data-task-title="${task.title}">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                </div>
                ` : ''}
            </div>
        `).join('');

        // Добавляем обработчики для обновления прогресса
        document.querySelectorAll('.update-progress').forEach(btn => {
            btn.addEventListener('click', async (e) => {
                const taskTitle = e.target.getAttribute('data-task-title');
                const input = document.querySelector(`input[data-task-title="${taskTitle}"]`);
                const progress = parseInt(input.value);

                if (progress >= 0 && progress <= 100) {
                    await this.handleUpdateProgress(taskTitle, progress);
                } else {
                    utils.showMessage('taskMessages', 'Прогресс должен быть от 0 до 100');
                }
            });
        });

        // Добавляем обработчики для редактирования/удаления задач
        document.querySelectorAll('.edit-task, .delete-task').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const taskId = e.target.closest('.task-action').getAttribute('data-task-id');
                const action = e.target.closest('.task-action').classList.contains('edit-task') ? 'edit' : 'delete';

                if (action === 'edit') {
                    utils.showMessage('taskMessages', 'Редактирование задач временно недоступно');
                } else {
                    if (confirm('Вы уверены, что хотите удалить эту задачу?')) {
                        this.handleDeleteTask(taskId);
                    }
                }
            });
        });
    },

    async handleDeleteTask(taskId) {
        try {
            const task = allTasks.find(t => t.id == taskId);
            if (!task || !task.employee) {
                utils.showMessage('taskMessages', 'Не удалось найти задачу для удаления');
                return;
            }

            // В реальном приложении здесь будет вызов API для удаления
            utils.showMessage('taskMessages', 'Удаление задач через API временно отключено', 'success');
        } catch (error) {
            utils.showMessage('taskMessages', 'Ошибка при удалении задачи');
        }
    },

    renderUsers() {
        const container = document.getElementById('employeesList');
        if (!allUsers || allUsers.length === 0) {
            container.innerHTML = `
                <div class="task-card" style="grid-column: 1 / -1; text-align: center; padding: 48px;">
                    <i class="fas fa-users" style="font-size: 48px; margin-bottom: 16px; opacity: 0.5;"></i>
                    <h3 style="margin-bottom: 8px;">Нет сотрудников</h3>
                    <p style="color: var(--text-secondary);">Сотрудники не найдены</p>
                </div>
            `;
            return;
        }

        container.innerHTML = allUsers.map(user => `
            <div class="task-card">
                <div class="task-header">
                    <div class="task-assignee">
                        <div class="assignee-avatar">${user.username ? user.username.charAt(0).toUpperCase() : 'U'}</div>
                        <div>
                            <h3 class="task-title">${user.name || ''} ${user.surname || ''}</h3>
                            <p style="color: var(--text-secondary); font-size: 14px;">
                                ${user.username || ''} • ${user.role || ''}
                            </p>
                        </div>
                    </div>
                </div>
                <p class="task-description">${user.email_user || 'Email не указан'}</p>
                <div class="task-footer">
                    <span style="font-size: 14px; color: var(--text-secondary);">
                        Зарегистрирован: ${utils.formatDate(user.created_at)}
                    </span>
                </div>
            </div>
        `).join('');
    },

    updateUserSelects() {
        const select = document.getElementById('taskUsername');
        select.innerHTML = '<option value="">Выберите сотрудника</option>';

        allUsers.filter(user => user.role === 'employee').forEach(user => {
            const option = document.createElement('option');
            option.value = user.username;
            option.textContent = `${user.name || ''} ${user.surname || ''} (${user.username || ''})`.trim();
            select.appendChild(option);
        });
    },

    updateStats() {
        const totalTasks = allTasks.length;
        const completedTasks = allTasks.filter(task => task.progress === 100).length;
        const pendingTasks = totalTasks - completedTasks;
        const performance = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;

        document.getElementById('totalTasks').textContent = totalTasks;
        document.getElementById('completedTasks').textContent = completedTasks;
        document.getElementById('pendingTasks').textContent = pendingTasks;
        document.getElementById('performance').textContent = `${performance}%`;
    },

    updateActionButtons() {
        const taskButtons = document.getElementById('taskActionButtons');
        const employeeButtons = document.getElementById('employeeActionButtons');

        taskButtons.innerHTML = '';
        employeeButtons.innerHTML = '';

        if (currentUser.role === 'manager' || currentUser.role === 'admin') {
            // Кнопка создания задачи
            const createTaskBtn = document.createElement('button');
            createTaskBtn.className = 'btn btn-primary';
            createTaskBtn.innerHTML = '<i class="fas fa-plus"></i> Создать задачу';
            createTaskBtn.addEventListener('click', () => this.showModal('createTaskModal'));
            taskButtons.appendChild(createTaskBtn);
        }

        if (currentUser.role === 'admin') {
            // Кнопка создания пользователя
            const createUserBtn = document.createElement('button');
            createUserBtn.className = 'btn btn-primary';
            createUserBtn.innerHTML = '<i class="fas fa-user-plus"></i> Создать пользователя';
            createUserBtn.addEventListener('click', () => this.showModal('createUserModal'));
            employeeButtons.appendChild(createUserBtn);
        }
    },

    showSection(sectionId) {
        document.querySelectorAll('.content-section').forEach(section => {
            section.classList.remove('active');
        });
        document.querySelectorAll('.nav-link').forEach(link => {
            link.classList.remove('active');
        });

        document.getElementById(sectionId).classList.add('active');
        document.querySelector(`[data-section="${sectionId}"]`).classList.add('active');

        document.getElementById('userDropdown').classList.remove('active');

        // Перезагружаем данные при переключении разделов
        if (sectionId === 'tasks') {
            this.loadTasks();
        } else if (sectionId === 'employees') {
            this.loadUsers();
        }
    },

    showModal(modalId) {
        document.getElementById(modalId).style.display = 'flex';
        utils.clearMessages(modalId.replace('Modal', 'Messages'));
    },

    hideModal(modalId) {
        document.getElementById(modalId).style.display = 'none';
        utils.clearMessages(modalId.replace('Modal', 'Messages'));
    },

    async handleCreateTask() {
        const username = document.getElementById('taskUsername').value;
        const title = document.getElementById('taskTitle').value.trim();
        const description = document.getElementById('taskDescription').value.trim();
        const priority = document.getElementById('taskPriority').value;
        const deadline = document.getElementById('taskDeadline').value;

        if (!username || !title || !description) {
            utils.showMessage('createTaskMessages', 'Пожалуйста, заполните все обязательные поля');
            return;
        }

        const taskData = {
            username,
            title,
            description,
            priority,
            deadline: deadline ? new Date(deadline).toISOString() : null
        };

        const createBtn = document.getElementById('createTaskBtn');
        utils.showLoading(createBtn);

        try {
            await api.createTask(taskData);
            utils.showMessage('createTaskMessages', 'Задача успешно создана!', 'success');

            setTimeout(() => {
                this.hideModal('createTaskModal');
                this.loadTasks();

                // Очистка формы
                document.getElementById('taskTitle').value = '';
                document.getElementById('taskDescription').value = '';
                document.getElementById('taskDeadline').value = '';
            }, 1500);
        } catch (error) {
            utils.showMessage('createTaskMessages', error.message || 'Ошибка создания задачи');
        } finally {
            utils.hideLoading(createBtn);
        }
    },

    async handleCreateUser() {
        const username = document.getElementById('userUsername').value.trim();
        const password = document.getElementById('userPassword').value;
        const role = document.getElementById('userRole').value;
        const name = document.getElementById('userName').value.trim();
        const surname = document.getElementById('userSurname').value.trim();
        const email = document.getElementById('userEmail').value.trim();

        if (!username || !password || !name || !surname || !email) {
            utils.showMessage('createUserMessages', 'Пожалуйста, заполните все поля');
            return;
        }

        if (password.length < 4) {
            utils.showMessage('createUserMessages', 'Пароль должен быть не менее 4 символов');
            return;
        }

        const userData = {
            username,
            password,
            role,
            name,
            surname,
            email_user: email
        };

        const createBtn = document.getElementById('createUserBtn');
        utils.showLoading(createBtn);

        try {
            await api.createUser(userData);
            utils.showMessage('createUserMessages', 'Пользователь успешно создан!', 'success');

            setTimeout(() => {
                this.hideModal('createUserModal');
                this.loadUsers();

                // Очистка формы
                document.getElementById('userUsername').value = '';
                document.getElementById('userPassword').value = '';
                document.getElementById('userName').value = '';
                document.getElementById('userSurname').value = '';
                document.getElementById('userEmail').value = '';
            }, 1500);
        } catch (error) {
            utils.showMessage('createUserMessages', error.message || 'Ошибка создания пользователя');
        } finally {
            utils.hideLoading(createBtn);
        }
    },

    async handleUpdateProgress(taskTitle, progress) {
        try {
            await api.updateTaskProgress(taskTitle, progress);
            utils.showMessage('taskMessages', 'Прогресс обновлен!', 'success');
            await this.loadTasks();
        } catch (error) {
            utils.showMessage('taskMessages', error.message || 'Ошибка обновления прогресса');
        }
    },

    async handleAIMessage() {
        const input = document.getElementById('assistantInput');
        const message = input.value.trim();

        if (!message) return;

        // Добавляем сообщение пользователя
        this.addAIMessage(message, 'user');
        input.value = '';
        input.style.height = '44px';

        // Показываем индикатор загрузки
        const sendButton = document.getElementById('assistantSend');
        sendButton.disabled = true;
        sendButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';

        try {
            const response = await api.aiRequest(message);
            this.addAIMessage(response, 'assistant');
        } catch (error) {
            this.addAIMessage('Извините, произошла ошибка. Попробуйте еще раз.', 'assistant');
        } finally {
            sendButton.disabled = false;
            sendButton.innerHTML = '<i class="fas fa-paper-plane"></i>';
        }
    },

    addAIMessage(text, sender) {
        const container = document.getElementById('assistantMessages');
        const messageElement = document.createElement('div');
        messageElement.className = `message message-${sender}`;
        messageElement.textContent = text;
        container.appendChild(messageElement);
        container.scrollTop = container.scrollHeight;
    },

    getPriorityText(priority) {
        const priorityMap = {
            'low': 'Низкий',
            'medium': 'Средний',
            'high': 'Высокий'
        };
        return priorityMap[priority] || priority;
    }
};

// Инициализация приложения
document.addEventListener('DOMContentLoaded', () => {
    ui.init();
});
    </script>
</body>
</html>